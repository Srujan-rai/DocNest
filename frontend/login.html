<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sign In - My App</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap"
      rel="stylesheet"
    />

    <style>
      :root {
        --primary-color: #4285f4; /* Google Blue */
        --background-color: #f7f9fc;
        --container-bg: #ffffff;
        --text-color: #333;
        --error-color: #db4437; /* Google Red */
        --success-color: #34a853; /* Google Green */
        --button-hover: #3367d6;
        --shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      }

      body {
        font-family: "Roboto", sans-serif;
        background-color: var(--background-color);
        margin: 0;
        padding: 0;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh; /* Full viewport height */
        color: var(--text-color);
      }

      .login-container {
        background-color: var(--container-bg);
        padding: 40px 50px;
        border-radius: 12px;
        box-shadow: var(--shadow);
        text-align: center;
        max-width: 400px;
        width: 90%;
        animation: fadeIn 0.5s ease-out;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(-10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .login-container h1 {
        color: var(--text-color);
        margin-bottom: 15px;
        font-weight: 500;
      }

      .login-container p {
        margin-bottom: 30px;
        color: #666;
        font-size: 0.95em;
      }

      #googleSignInBtn {
        display: inline-flex; /* Use flex to align items inside */
        align-items: center; /* Center items vertically */
        justify-content: center; /* Center items horizontally */
        width: 100%; /* Full width */
        padding: 12px 20px;
        margin-top: 10px;
        background-color: var(--primary-color);
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 1em;
        font-weight: 500;
        transition: background-color 0.2s ease, box-shadow 0.2s ease;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      #googleSignInBtn:hover {
        background-color: var(--button-hover);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
      }

      #googleSignInBtn img {
        margin-right: 12px; /* Space between icon and text */
        height: 20px; /* Adjust icon size */
        width: 20px;
        background-color: #fff; /* White background for Google icon */
        border-radius: 2px; /* Slightly rounded corners for icon bg */
        padding: 2px; /* Small padding around icon */
        vertical-align: middle; /* Align icon nicely if needed */
      }

      #message {
        margin-top: 25px;
        font-weight: 500;
        min-height: 1.2em;
        font-size: 0.9em;
      }

      .error {
        color: var(--error-color);
      }
      .success {
        color: var(--success-color);
      } /* Though success often leads to redirect */

      /* Optional: Add a subtle logo */
      .logo {
        width: 60px;
        height: 60px;
        margin: 0 auto 20px auto;
        /* background-image: url('your-logo.png'); */ /* Uncomment and set your logo */
        background-color: #eee; /* Placeholder */
        border-radius: 50%;
        background-size: cover;
      }
    </style>
  </head>
  <body>
    <div class="login-container">
      <div class="logo"></div>
      <h1>Welcome Back!</h1>
      <p>Sign in quickly with your Google account.</p>

      <button id="googleSignInBtn">
        <img
          src="./icons/google.svg"
          alt="Google icon"
          width="{18}"
          height="{18}"
        />

        Sign in with Google
      </button>

      <p id="message"></p>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>

    <script>
      // --- IMPORTANT ---
      // Replace this with your actual Firebase project configuration!
      const firebaseConfig = {
        apiKey: "YOUR_API_KEY",
        authDomain: "YOUR_AUTH_DOMAIN",
        projectId: "YOUR_PROJECT_ID",
        storageBucket: "YOUR_STORAGE_BUCKET",
        messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
        appId: "YOUR_APP_ID",
      };

      // --- Initialize Firebase ---
      try {
        firebase.initializeApp(firebaseConfig);
      } catch (e) {
        console.error("Firebase initialization error:", e);
        const msgElement = document.getElementById("message");
        if (msgElement) {
          msgElement.textContent =
            "Error initializing application. Please try again later.";
          msgElement.className = "error";
        }
        // Hide button if Firebase fails
        const googleBtn = document.getElementById("googleSignInBtn");
        if (googleBtn) googleBtn.style.display = "none";
      }
      const auth = firebase.auth();

      // --- Get DOM Elements ---
      const googleSignInBtn = document.getElementById("googleSignInBtn");
      const messageElement = document.getElementById("message");

      // --- Constants ---
      const LANDING_PAGE_URL = "index.html"; // Your target page

      // --- Event Listeners ---
      if (googleSignInBtn) {
        googleSignInBtn.addEventListener("click", handleGoogleSignIn);
      } else {
        console.error("Google Sign In button not found.");
      }

      // --- Authentication Functions ---

      function handleGoogleSignIn() {
        const provider = new firebase.auth.GoogleAuthProvider();
        clearMessage();
        // Optionally disable button while processing
        if (googleSignInBtn) googleSignInBtn.disabled = true;
        setMessage("Redirecting to Google...", "success"); // Give feedback

        auth
          .signInWithPopup(provider)
          .then((result) => {
            console.log("Google Sign-In Successful!", result.user);
            // REDIRECT on success - No need for message here
            window.location.href = LANDING_PAGE_URL;
          })
          .catch((error) => {
            console.error("Google Sign-In Error:", error.code, error.message);
            if (googleSignInBtn) googleSignInBtn.disabled = false; // Re-enable button on error

            if (error.code === "auth/popup-closed-by-user") {
              setMessage("Sign-in cancelled.", "error");
            } else {
              setMessage(`Sign-in Error: ${error.message}`, "error");
            }
          });
      }

      // --- Helper Functions for Messages ---
      function setMessage(msg, type = "error") {
        if (messageElement) {
          messageElement.textContent = msg;
          messageElement.className = type;
        }
      }

      function clearMessage() {
        if (messageElement) {
          messageElement.textContent = "";
          messageElement.className = "";
        }
      }

      // --- Firebase Auth State Observer ---
      auth.onAuthStateChanged((user) => {
        if (user) {
          // User is ALREADY signed in (e.g., returning to login page)
          console.log("User already signed in, redirecting to landing page.");
          // Immediately redirect to the landing page
          window.location.href = LANDING_PAGE_URL;
        } else {
          // User is signed out.
          // Make sure the sign-in button is visible and enabled
          console.log("No user signed in. Ready for login.");
          if (googleSignInBtn) {
            googleSignInBtn.style.display = "inline-flex"; // Ensure it's visible
            googleSignInBtn.disabled = false; // Ensure it's enabled
          }
          clearMessage(); // Clear any previous messages
        }
      });
    </script>
  </body>
</html>
